<!DOCTYPE html>
<!--
    Copyright (c) 2019 Vinnie Falco (vinnie.falco@gmail.com)

    Distributed under the Boost Software License, Version 1.0. (See accompanying
    file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

    Official repository: https://github.com/vinniefalco/json
-->
<html>
<head>
<font face="arial"/>
</head>
<body>
<h1>Boost.JSON Benchmarks</h1>
<div id="benchmarks">
</div>
<br>
<textarea id="data" cols="60" rows="20" overflow="hidden" onkeyup="autosize(this)">
Parse strings.json,msvc x64,boost (pool),5042
Parse strings.json,msvc x64,rapidjson (pool),278
Parse integers-32.json,msvc x64,boost (pool),343
Parse integers-32.json,msvc x64,rapidjson (pool),276
Parse integers-64.json,msvc x64,boost (pool),587
Parse integers-64.json,msvc x64,rapidjson (pool),396
Parse twitter.json,msvc x64,boost (pool),368
Parse twitter.json,msvc x64,rapidjson (pool),295
Parse small.json,msvc x64,boost (pool),249
Parse small.json,msvc x64,rapidjson (pool),249
Parse array.json,msvc x64,boost (pool),238
Parse array.json,msvc x64,rapidjson (pool),239
Parse random.json,msvc x64,boost (pool),244
Parse random.json,msvc x64,rapidjson (pool),294
Parse citm_catalog.json,msvc x64,boost (pool),482
Parse citm_catalog.json,msvc x64,rapidjson (pool),741
Parse canada.json,msvc x64,boost (pool),339
Parse canada.json,msvc x64,rapidjson (pool),330
Serialize strings.json,msvc x64,boost (pool),6493
Serialize strings.json,msvc x64,rapidjson (pool),5668
Serialize integers-32.json,msvc x64,boost (pool),687
Serialize integers-32.json,msvc x64,rapidjson (pool),738
Serialize integers-64.json,msvc x64,boost (pool),796
Serialize integers-64.json,msvc x64,rapidjson (pool),804
Serialize twitter.json,msvc x64,boost (pool),1149
Serialize twitter.json,msvc x64,rapidjson (pool),716
Serialize small.json,msvc x64,boost (pool),1062
Serialize small.json,msvc x64,rapidjson (pool),645
Serialize array.json,msvc x64,boost (pool),422
Serialize array.json,msvc x64,rapidjson (pool),347
Serialize random.json,msvc x64,boost (pool),774
Serialize random.json,msvc x64,rapidjson (pool),528
Serialize citm_catalog.json,msvc x64,boost (pool),1608
Serialize citm_catalog.json,msvc x64,rapidjson (pool),1522
Serialize canada.json,msvc x64,boost (pool),360
Serialize canada.json,msvc x64,rapidjson (pool),248
Parse strings.json,clang x64,boost (pool),5649
Parse strings.json,clang x64,rapidjson (pool),454
Parse integers-32.json,clang x64,boost (pool),372
Parse integers-32.json,clang x64,rapidjson (pool),276
Parse integers-64.json,clang x64,boost (pool),629
Parse integers-64.json,clang x64,rapidjson (pool),397
Parse twitter.json,clang x64,boost (pool),425
Parse twitter.json,clang x64,rapidjson (pool),436
Parse small.json,clang x64,boost (pool),285
Parse small.json,clang x64,rapidjson (pool),335
Parse array.json,clang x64,boost (pool),258
Parse array.json,clang x64,rapidjson (pool),265
Parse random.json,clang x64,boost (pool),285
Parse random.json,clang x64,rapidjson (pool),404
Parse citm_catalog.json,clang x64,boost (pool),530
Parse citm_catalog.json,clang x64,rapidjson (pool),836
Parse canada.json,clang x64,boost (pool),370
Parse canada.json,clang x64,rapidjson (pool),324
Serialize strings.json,clang x64,boost (pool),7681
Serialize strings.json,clang x64,rapidjson (pool),6391
Serialize integers-32.json,clang x64,boost (pool),700
Serialize integers-32.json,clang x64,rapidjson (pool),677
Serialize integers-64.json,clang x64,boost (pool),1047
Serialize integers-64.json,clang x64,rapidjson (pool),1001
Serialize twitter.json,clang x64,boost (pool),1674
Serialize twitter.json,clang x64,rapidjson (pool),1048
Serialize small.json,clang x64,boost (pool),1707
Serialize small.json,clang x64,rapidjson (pool),833
Serialize array.json,clang x64,boost (pool),455
Serialize array.json,clang x64,rapidjson (pool),378
Serialize random.json,clang x64,boost (pool),1160
Serialize random.json,clang x64,rapidjson (pool),654
Serialize citm_catalog.json,clang x64,boost (pool),2232
Serialize citm_catalog.json,clang x64,rapidjson (pool),1669
Serialize canada.json,clang x64,boost (pool),455
Serialize canada.json,clang x64,rapidjson (pool),256
Parse strings.json,msvc x86,boost (pool),2531
Parse strings.json,msvc x86,rapidjson (pool),283
Parse integers-32.json,msvc x86,boost (pool),318
Parse integers-32.json,msvc x86,rapidjson (pool),209
Parse integers-64.json,msvc x86,boost (pool),407
Parse integers-64.json,msvc x86,rapidjson (pool),263
Parse twitter.json,msvc x86,boost (pool),318
Parse twitter.json,msvc x86,rapidjson (pool),283
Parse small.json,msvc x86,boost (pool),237
Parse small.json,msvc x86,rapidjson (pool),240
Parse array.json,msvc x86,boost (pool),208
Parse array.json,msvc x86,rapidjson (pool),172
Parse random.json,msvc x86,boost (pool),242
Parse random.json,msvc x86,rapidjson (pool),263
Parse citm_catalog.json,msvc x86,boost (pool),410
Parse citm_catalog.json,msvc x86,rapidjson (pool),666
Parse canada.json,msvc x86,boost (pool),252
Parse canada.json,msvc x86,rapidjson (pool),217
Serialize strings.json,msvc x86,boost (pool),6733
Serialize strings.json,msvc x86,rapidjson (pool),5745
Serialize integers-32.json,msvc x86,boost (pool),461
Serialize integers-32.json,msvc x86,rapidjson (pool),515
Serialize integers-64.json,msvc x86,boost (pool),348
Serialize integers-64.json,msvc x86,rapidjson (pool),354
Serialize twitter.json,msvc x86,boost (pool),1054
Serialize twitter.json,msvc x86,rapidjson (pool),777
Serialize small.json,msvc x86,boost (pool),1026
Serialize small.json,msvc x86,rapidjson (pool),679
Serialize array.json,msvc x86,boost (pool),281
Serialize array.json,msvc x86,rapidjson (pool),240
Serialize random.json,msvc x86,boost (pool),560
Serialize random.json,msvc x86,rapidjson (pool),392
Serialize citm_catalog.json,msvc x86,boost (pool),1545
Serialize citm_catalog.json,msvc x86,rapidjson (pool),1509
Serialize canada.json,msvc x86,boost (pool),160
Serialize canada.json,msvc x86,rapidjson (pool),109
Parse strings.json,clang x86,boost (pool),2669
Parse strings.json,clang x86,rapidjson (pool),444
Parse integers-32.json,clang x86,boost (pool),294
Parse integers-32.json,clang x86,rapidjson (pool),233
Parse integers-64.json,clang x86,boost (pool),385
Parse integers-64.json,clang x86,rapidjson (pool),325
Parse twitter.json,clang x86,boost (pool),348
Parse twitter.json,clang x86,rapidjson (pool),399
Parse small.json,clang x86,boost (pool),258
Parse small.json,clang x86,rapidjson (pool),297
Parse array.json,clang x86,boost (pool),213
Parse array.json,clang x86,rapidjson (pool),199
Parse random.json,clang x86,boost (pool),278
Parse random.json,clang x86,rapidjson (pool),369
Parse citm_catalog.json,clang x86,boost (pool),458
Parse citm_catalog.json,clang x86,rapidjson (pool),797
Parse canada.json,clang x86,boost (pool),256
Parse canada.json,clang x86,rapidjson (pool),316
Serialize strings.json,clang x86,boost (pool),7075
Serialize strings.json,clang x86,rapidjson (pool),6364
Serialize integers-32.json,clang x86,boost (pool),366
Serialize integers-32.json,clang x86,rapidjson (pool),443
Serialize integers-64.json,clang x86,boost (pool),325
Serialize integers-64.json,clang x86,rapidjson (pool),330
Serialize twitter.json,clang x86,boost (pool),1025
Serialize twitter.json,clang x86,rapidjson (pool),1005
Serialize small.json,clang x86,boost (pool),1036
Serialize small.json,clang x86,rapidjson (pool),819
Serialize array.json,clang x86,boost (pool),256
Serialize array.json,clang x86,rapidjson (pool),287
Serialize random.json,clang x86,boost (pool),551
Serialize random.json,clang x86,rapidjson (pool),514
Serialize citm_catalog.json,clang x86,boost (pool),1332
Serialize citm_catalog.json,clang x86,rapidjson (pool),1658
Serialize canada.json,clang x86,boost (pool),125
Serialize canada.json,clang x86,rapidjson (pool),144
</textarea>

<script>

var Width = 600;

function autosize (f) {
  if (f.scrollHeight > f.clientHeight) {
    f.style.height = f.scrollHeight + "px";
  }
}

// Draw a single bar chart representing
// results for one platform and architecture
function draw_chart(ctx, title, rows, mbsMax) {
    var xMax = Math.max(...Object.values(rows));

    // gray separator
    ctx.beginPath();
    ctx.strokeStyle = "#A0A0A0";
    ctx.moveTo(0, 0.5);
    ctx.lineTo(Width, 0.5);
    ctx.stroke();
    ctx.translate(0, 28);

    // title
    ctx.textAlign = "left";
    ctx.fillStyle = "#000000";
    ctx.font = 'bold 16px sans-serif';
    ctx.fillText(title, 0, 0);
    ctx.translate(0, 26);

    // chart rows
    Object.entries(rows).forEach(([name, mbs]) =>
    {
        var dy = 4;

        ctx.textAlign = "left";
        ctx.fillStyle = "#000000";
        ctx.font = '14px sans-serif';
        ctx.fillText(name, 0, 0);

        var xMbs = 195;
        if(name.startsWith("boost"))
            ctx.fillStyle = "#eb342a";
        else
            ctx.fillStyle = "#909090";
        var w = (Width - 170) * mbs / mbsMax
        if(w < xMbs - 120)
            w = xMbs - 120;
        ctx.fillRect(130, -20+dy, w, 20);

        ctx.textAlign = "right";
        ctx.font = '13px sans-serif';
        ctx.fillStyle = "#000000";
        ctx.fillText(mbs + " MB/s", xMbs + 1, 1);
        ctx.fillStyle = "#ffffff";
        ctx.fillText(mbs + " MB/s", xMbs, 0);

        ctx.translate(0, 24);
    });

    // gray separator
    ctx.translate(0, -4);
    ctx.beginPath();
    ctx.strokeStyle = "#A0A0A0";
    ctx.moveTo(0, 0.5);
    ctx.lineTo(Width, 0.5);
    ctx.stroke();
}

// Draw multiple bar charts, one
// for each platform and architecture
function draw_charts(ctx, tab, mbsMax) {
    // top margin
    ctx.translate(0, 16);

    // draw each chart
    Object.entries(tab).forEach(([name, rows]) =>
    {
        draw_chart(ctx, name, rows, mbsMax);
    });

    // bottom margin
    ctx.translate(0, 16);
}

function measure_and_draw(canvas, tab) {
    mbsMax = 0;
    Object.entries(tab).forEach(([name, rows]) =>
    {
        mbsMax = Math.max(mbsMax, ...Object.values(rows));
    });

    var LeftMargin = 48;

    // Measure the height needed
    canvas.width = Width;
    canvas.height = 30000;
    var ctx = canvas.getContext("2d");
    ctx.save();
    draw_charts(ctx, tab);
    var tx = ctx.getTransform();
    var height = tx["f"];

    // Resize the canvas to fit
    canvas.width = LeftMargin + Width + 20;
    canvas.height = height;

    // Make everything opaque
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.translate(LeftMargin, 0);
    draw_charts(ctx, tab, mbsMax);
    ctx.restore();
}

function update()
{
    var tab = new Object();
    var lines = data.value.split('\n');
    for (var i = 0; i < lines.length; i++)
    {
        if(lines[i].length == 0)
            continue;
        items = lines[i].split(',');
        var title = items[0]
        var target = items[1];
        var name = items[2];
        var mbs = items[3];
        if(! (title in tab))
            tab[title] = new Object();
        if(! (target in tab[title]))
            tab[title][target] = new Object();
        var set = tab[title][target];
        if(! (name in set))
            set[name] = new Object();           
        set[name] = mbs;
    }

    benchmarks.innerHTML = "";
    Object.entries(tab).forEach(([title, charts]) =>
    {
        benchmarks.innerHTML +=
            "<h2>" + title + "</h2>" +
            "<canvas id=\"" + title + "\" width=\"800\" height=\"600\">";
    });
    Object.entries(tab).forEach(([title, charts]) =>
    {
        measure_and_draw(document.getElementById(title), charts)
    });
}

data.oninput = function()
{
    update();
}

update();

</script>
</body>
</html>
